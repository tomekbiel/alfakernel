<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System Overview | MT4â€“Python Bridge</title>
  <link rel="stylesheet" href="../../css/modern-style.css" />
  
</head>
<body>
  <header>
    <h1>System Overview</h1>
    <nav>
      <ul>
        <li><a href="index.html">â† MT4â€“Python Bridge</a></li>
        <li><a href="install-guide.html">Installation</a></li>
        <li><a href="market-data.html">Market Data</a></li>
        <li><a href="analysis.html">Analysis</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="desc-section">
      <h2>How the MT4â€“Python Bridge Works</h2>
      <p>
        The MT4â€“Python Bridge enables robust, real-time communication between MetaTrader 4 (MT4) and Python. 
        The system is built around a modular architecture using ZeroMQ sockets for fast, asynchronous messaging.
      </p>
      <ul>
        <li>
          <strong>MT4 Side:</strong> A custom Expert Advisor (EA) written in MQL4 sends and receives data/events via ZeroMQ sockets.
        </li>
        <li>
          <strong>Python Side:</strong> The <code>mt4_connector</code> package contains core classes for messaging, data handling, and trading commands.
        </li>
        <li>
          <strong>Inheritance & Modularity:</strong> All handlers (market data, trading, historical) inherit from <code>BaseConnector</code>, which manages the ZeroMQ connection and message parsing.
        </li>
        <li>
          <strong>Entry Point:</strong> Scripts in <code>scripts/</code> (e.g. <code>run_mt4.py</code>, <code>fetch_single.py</code>) instantiate and use these handlers for specific tasks.
        </li>
        <li>
          <strong>Data Flow:</strong> 
          <ul>
            <li>Market data is streamed live via PUB/SUB sockets.</li>
            <li>Historical data is fetched on demand via COMMAND/RESPONSE.</li>
            <li>Trade commands are sent from Python to MT4 via PUSH/REP.</li>
          </ul>
        </li>
      </ul>
      <p>
        <strong>Common issues:</strong> Connection problems may occur due to port conflicts, firewall settings, or mismatched ZeroMQ versions. 
        Always check logs and ensure both MT4 and Python are running compatible bridge scripts.
      </p>
    </section>

    <section>
      <h2>Python Module Preview</h2>
      <p>Click a file below to load and preview its code directly from the GitHub repository:</p>
      <div class="file-list">
        <div class="file-button">
          <button onclick="loadCode('init_py', 'mt4_connector/__init__.py')">ğŸ“„ mt4_connector/__init__.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('base_connector', 'mt4_connector/base_connector.py')">ğŸ“„ mt4_connector/base_connector.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('command_sender', 'mt4_connector/command_sender.py')">ğŸ“„ mt4_connector/command_sender.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('market_data_handler', 'mt4_connector/market_data_handler.py')">ğŸ“„ mt4_connector/market_data_handler.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('trade_defaults', 'mt4_connector/trade_defaults.py')">ğŸ“„ mt4_connector/trade_defaults.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('fetch_single', 'scripts/historical/fetch_single.py')">ğŸ“„ scripts/historical/fetch_single.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('fetch_launcher', 'scripts/historical/fetch_launcher.py')">ğŸ“„ scripts/historical/fetch_launcher.py</button>
        </div>
        <div class="file-button">
          <button onclick="loadCode('run_mt4', 'scripts/run_mt4.py')">ğŸ“„ scripts/run_mt4.py</button>
        </div>
      </div>
      <div id="code_container">
        <div id="init_py" class="code-preview"></div>
        <div id="base_connector" class="code-preview"></div>
        <div id="command_sender" class="code-preview"></div>
        <div id="market_data_handler" class="code-preview"></div>
        <div id="trade_defaults" class="code-preview"></div>
        <div id="fetch_single" class="code-preview"></div>
        <div id="fetch_launcher" class="code-preview"></div>
        <div id="run_mt4" class="code-preview"></div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 AlfaKernel. All rights reserved.</p>
  </footer>

  <script>
    function loadCode(id, path) {
      const container = document.getElementById(id);
      // Hide all other previews
      document.querySelectorAll('.code-preview').forEach(div => {
        if (div !== container) div.style.display = 'none';
      });
      // Toggle or load the selected file
      if (container.innerText.trim() !== '') {
        container.style.display = container.style.display === 'none' ? 'block' : 'none';
        return;
      }
      fetch(`https://raw.githubusercontent.com/tomekbiel/MT4_Trading_System/master/${path}`)
        .then(res => res.ok ? res.text() : Promise.reject(res))
        .then(code => {
          container.innerText = code;
          container.style.display = 'block';
        })
        .catch(() => {
          container.innerText = 'âš ï¸ Error loading file.';
          container.style.display = 'block';
        });
    }
  </script>
</body>
</html>
